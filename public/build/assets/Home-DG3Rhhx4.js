import{r as t,j as e,c as T}from"./app-BcfCYjP3.js";import{P as I}from"./PublicLayout-DnnxhcwX.js";import{P as k}from"./PublicNav-7nDRZDgy.js";import N from"./LocationCombobox-U4gam9QI.js";import H from"./SelectFishMobile-Bd-FwK-p.js";import U from"./SelectFishDesktop-CTbQG7bI.js";import A from"./FishingRestrictions-DqowyPan.js";import"./ResponsiveNavLink-DleO5Im0.js";import"./transition-BKbPEF0Y.js";import"./index-Cd7445Tf.js";import"./getFishImageSrc-bMjek-YH.js";import"./parseMySqlDate-BUpSl06p.js";import"./format-wWbDcfoj.js";import"./FishRestrictionsTable-DxoOKkVg.js";import"./Tooltip-CGPOk1Z0.js";function B({title:r,titleId:a,...l},i){return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":a},l),r?t.createElement("title",{id:a},r):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"}))}const _=t.forwardRef(B);function f(r){const a={loading:!1,error:null,data:null},l=(c,o)=>{switch(o.type){case"FETCH_START":return{...c,loading:!0,error:null};case"FETCH_SUCCESS":return{...c,loading:!1,data:o.payload};case"FETCH_FAILURE":return{...c,loading:!1,error:o.payload};default:return c}},[i,d]=t.useReducer(l,a);return{state:i,get:async c=>{d({type:"FETCH_START"});try{const o={nocache:r?Date.parse(r):null},h=await axios.get(c,{params:o});return d({type:"FETCH_SUCCESS",payload:h.data}),h}catch(o){return d({type:"FETCH_FAILURE",payload:o.message}),o}}}}function P({selectedLocation:r,onClick:a}){const l=t.useRef(null);return t.useEffect(()=>{l.current&&l.current.focus()},[l]),e.jsxs("button",{ref:l,"aria-label":"Back to search",onClick:a,className:"SelectedLocationButton",children:[e.jsx("strong",{children:r.label.split("/").map(i=>e.jsx("span",{children:i},i))}),e.jsx(_,{})]})}function ee({apiLastModified:r}){var F,b;const[a,l]=t.useState(null),[i,d]=t.useState(null),[p,c]=t.useState(null),[o,h]=t.useState(null),[s,x]=t.useState(null),g=t.useRef(null),m=T();m.setLandingPage("home");const E=f(r),C=f(r),S=f(r);t.useEffect(()=>{E.get("/api/fishes").then(n=>l(n.data.fishes)),C.get("/api/locations").then(n=>d(n.data.locations))},[]),t.useEffect(()=>{const n=m.getUserSelectedFish();n&&h(n)},[]),t.useEffect(()=>{var n;if(s){c(null);let u="/api/fishByLocation/"+s.value.regionId;u+="/"+(((n=s.value)==null?void 0:n.waterId)??0),u+="/"+(o??0),S.get(u).then(L=>{c(L.data.limits)})}},[s,o]);const j=n=>{let u;o===n?u=null:u=n,m.setUserSelectedFish(u),h(u)},R=()=>{x(null),setTimeout(()=>{g.current.click()},10)},y=n=>{x(n)},[w,v]=t.useState(null);return t.useEffect(()=>{},[w]),e.jsxs(I,{className:`Home ${s?"sub-heading":""}`,children:[e.jsx("header",{children:e.jsx(k,{children:e.jsxs("h1",{className:"hero",children:["Smart ",e.jsx("span",{children:"Fish"})]})})}),e.jsxs("main",{children:[a!==null&&i!==null&&e.jsxs("div",{className:"focused-layout",children:[e.jsx("div",{className:"header",children:s&&e.jsx(P,{selectedLocation:s,onClick:R})}),e.jsxs("div",{className:"body",children:[s?e.jsx(A,{isLoading:S.state.loading,restrictions:p,regionId:(F=s==null?void 0:s.value)==null?void 0:F.regionId,waterId:(b=s==null?void 0:s.value)==null?void 0:b.waterId}):null,e.jsx(N,{className:s?"hidden":"",inputRef:g,locations:i,placeholder:"Search by river, lake or region",onChange:y,exportState:v})]})]}),e.jsx("div",{className:"logo",children:e.jsx("img",{src:"/images/logo.png"})})]}),e.jsx("footer",{children:m.screenOrientation.isMobile?e.jsx(H,{fishes:a,selectedFishId:o,selectFish:j}):e.jsx(U,{fishes:a,selectedFishId:o,selectFish:j})})]})}export{ee as default};
