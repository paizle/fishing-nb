import{c as u,p as d}from"./parseMySqlDate-DjqKqIUd.js";import{t as i}from"./format-CU-xZK7a.js";function c(t,e){return+i(t)<+i(e)}function f(t,e){return+i(t)==+i(e)}function l(t){var e;return{seasonStart:d(t.season_start),seasonEnd:d(t.season_end),bagLimit:t.bag_limit,hookLimit:t.hook_release_limit,minSize:t.minimum_size,maxSize:t.maximum_size,fishingMethod:p(t),note:t.note,tidal:g(t),water:((e=t==null?void 0:t.water)==null?void 0:e.name)??"",waterDescription:t.water_description??""}}function p(t){var n,s;let e="";return((n=t==null?void 0:t.method)==null?void 0:n.name)==="May only be angled by artificial fly or baited barbless hook with a single point"?e="Fly Fishing":e=((s=t==null?void 0:t.method)==null?void 0:s.name)??"",e}function g(t){let e="";return t.tidal&&(e&&(e+=" in "),e+=t.tidal+" waters"),e}function h(t){return t.reduce((e,n)=>{let s=0,r=!1;for(;!r&&s<e.length;)!e[s].waterDescription&&f(n.seasonStart,e[s].seasonStart)&&f(n.seasonEnd,e[s].seasonEnd)&&n.bagLimit===e[s].bagLimit&&n.minimumSize===e[s].minimumSize&&n.maximumSize===e[s].maximumSize&&(r=!0,n.fishingMethod!==e[s].fishingMethod&&(e[s].fishingMethod=""),n.tidal!==e[s].tidal&&(e[s].tidal="")),s++;return r||e.push(n),e},[])}function S(t){return t.sort((e,n)=>{const s=u(e.seasonStart,n.seasonStart);return s===0?n.fishingMethod||n.tidal||n.waterDescription?-1:u(n.seasonEnd,e.seasonEnd):s})}function M(t){if(!t.length)return;const e=t.reduce((n,s)=>{var o;const r=((o=s==null?void 0:s.fish)==null?void 0:o.name)??null;if(!n[r]){const a={seasonStart:null,seasonEnd:null,limits:[]};n[r]=a}return n[r].limits.push(l(s)),n},{});return Object.keys(e).forEach(n=>{e[n].limits=h(e[n].limits),e[n].limits=S(e[n].limits),e[n].limits.forEach(o=>{o.bagLimit&&(e[n].seasonStart?c(o.seasonStart,e[n].seasonStart)&&(e[n].seasonStart=o.seasonStart):e[n].seasonStart=o.seasonStart,e[n].seasonEnd&&c(o.seasonEnd,e[n].seasonEnd)||(e[n].seasonEnd=o.seasonEnd))});const s={};let r=0;for(;r<e[n].limits.length;){const o=e[n].limits[r],a=[o.fishingMethod,o.tidal,o.waterDescription].join("-");o.waterDescription&&s[a]?(s[a].group||(s[a].group=[]),s[a].group.push(o),e[n].limits.splice(r,1)):(s[a]=o,r++)}}),e}export{M as f,h as r,S as s};
