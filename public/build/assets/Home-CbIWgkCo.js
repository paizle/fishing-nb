const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Map-Coox1mSQ.js","assets/app-hti74d3x.js","assets/app-l4988D9n.css","assets/Map-CS5X6EfR.css"])))=>i.map(i=>d[i]);
import{r as n,j as t,u as L,_ as B}from"./app-hti74d3x.js";import{P as U}from"./PublicLayout-C3euIlMc.js";import"./ResponsiveNavLink-bJUzw8Tw.js";import $ from"./LocationCombobox-Cy1pvJgr.js";import{g as F,F as A}from"./FishingRestrictions-cvxc8lMm.js";import{P}from"./PublicNav-CliBI9FF.js";import{L as k}from"./LoadingSpinner-BxlAb1i-.js";import"./transition-L-H9KNnr.js";import"./index-BKUn3FZA.js";import"./FishRestrictionsTable-DNk-IbId.js";import"./ExclamationTriangleIcon-DBWOy7Ty.js";import"./FishRestrictionsExceptionsTable-DDJ1htMu.js";function H({title:l,titleId:s,...o},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},o),l?n.createElement("title",{id:s},l):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const w=n.forwardRef(H);function I({title:l,titleId:s,...o},c){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":s},o),l?n.createElement("title",{id:s},l):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3"}))}const M=n.forwardRef(I);function f(l){const s={loading:!1,error:null,data:null},o=(a,e)=>{switch(e.type){case"FETCH_START":return{...a,loading:!0,error:null};case"FETCH_SUCCESS":return{...a,loading:!1,data:e.payload};case"FETCH_FAILURE":return{...a,loading:!1,error:e.payload};default:return a}},[c,r]=n.useReducer(o,s);return{state:c,get:async a=>{r({type:"FETCH_START"});try{const e={nocache:l?Date.parse(l):null},m=await axios.get(a,{params:e});return r({type:"FETCH_SUCCESS",payload:m.data}),m}catch(e){return r({type:"FETCH_FAILURE",payload:e.message}),e}}}}const O=({lowResSrc:l,highResSrc:s,alt:o,className:c=""})=>{const[r,i]=n.useState(!1);return t.jsxs("div",{className:`relative ${c}`,children:[r?null:t.jsx("img",{src:l,className:`low-res absolute inset-0 top-0 h-full w-full object-cover object-top transition-opacity duration-100 ${r?"opacity-0":"opacity-100"}`}),t.jsx("img",{src:s,alt:o,className:`h-full w-full object-cover object-top transition-opacity duration-100 ${r?"opacity-100":"opacity-0"}`,onLoad:()=>i(!0)})]})},D=n.memo(function({fishes:s=null,selectedFishId:o=null,selectFish:c=()=>null}){const[r,i]=n.useState(!0),a=n.useRef(null);return n.useEffect(()=>{r&&a.current&&s&&(o&&setTimeout(()=>{const e=a.current.querySelector(`[data-id="${o}"]`);e==null||e.scrollIntoView({behavior:"smooth",inline:"center"})}),i(!1))},[r,a.current,s,o]),t.jsx("div",{className:"SelectFishMobile",ref:a,role:"listbox","aria-label":"Select a fish",children:Object.keys(s||{}).map(e=>t.jsxs("button",{role:"option","aria-selected":o===s[e].id,"data-id":s[e].id,className:`fish ${o===s[e].id?"selected":""}`,onClick:()=>c(s[e].id),children:[t.jsx(O,{lowResSrc:"/images/fish-shadow.png",highResSrc:F(s[e].name),alt:s[e].name}),t.jsx("div",{className:"name",children:s[e].name})]},e))})}),W=n.memo(function({fishes:s=null,selectedFishId:o=null,selectFish:c=()=>null}){const r=n.useRef(null);n.useEffect(()=>{r.current&&s&&o&&setTimeout(()=>{const e=r.current.querySelector(`[data-id="${o}"]`);e==null||e.scrollIntoView({behavior:"smooth",inline:"center"})})},[r.current,s,o]);const i=()=>{r.current.scrollLeft===0?r.current.scrollLeft=r.current.scrollWidth:r.current.scrollLeft=r.current.scrollLeft-r.current.querySelector("[data-id]:first-child").getBoundingClientRect().width},a=()=>{r.current.scrollLeft+r.current.clientWidth>=r.current.scrollWidth?r.current.scrollLeft=0:r.current.scrollLeft=r.current.scrollLeft+r.current.querySelector("[data-id]:first-child").getBoundingClientRect().width};return t.jsx("div",{className:"SelectFishDesktop",children:t.jsxs("div",{className:"carousel",children:[t.jsx("div",{className:"fishes",ref:r,role:"listbox","aria-label":"Select a fish",children:Object.keys(s||{}).map(e=>t.jsxs("button",{role:"option","aria-selected":o===s[e].id,"data-id":s[e].id,className:`fish ${o===s[e].id?"selected":""}`,onClick:()=>c(s[e].id),children:[t.jsx("img",{src:F(s[e].name),alt:s[e].name}),t.jsx("div",{className:"name",children:s[e].name})]},s[e].name))}),t.jsxs("div",{className:"navigation",children:[t.jsx("button",{className:"go-left",onClick:()=>i(),children:t.jsx(w,{})}),t.jsx("button",{className:"go-right",onClick:()=>a(),children:t.jsx(w,{})})]})]})})});function q({selectedLocation:l,onClick:s}){const o=n.useRef(null);return n.useEffect(()=>{o.current&&o.current.focus()},[o]),t.jsxs("button",{ref:o,"aria-label":"Back to search",onClick:s,className:"SelectedLocationButton",children:[t.jsx("strong",{children:l.fullName}),t.jsx(M,{})]})}function V({apiLastModified:l,selectedLocation:s,selectedFish:o,selectFish:c}){const r=L(),[i,a]=n.useState(null),e=f(l);return n.useEffect(()=>{i?a(r.getFishes()):e.get("/api/fishes").then(m=>{a(r.setFishes(m.data.fishes))})},[]),r.screenOrientation.isMobile?t.jsx(D,{fishes:i,selectedFishId:o,selectFish:c}):t.jsx(W,{fishes:i,selectedFishId:o,selectFish:c})}function z({apiLastModified:l,selectedLocation:s,selectedFish:o,selectFish:c,children:r}){return t.jsxs(U,{className:`SmartFishLayout ${s?"sub-heading":""}`,children:[t.jsx("header",{children:t.jsx(P,{children:t.jsxs("h1",{className:"hero",children:["Smart ",t.jsx("span",{children:"Fish"})]})})}),t.jsx("main",{children:r}),t.jsx("footer",{children:t.jsx(V,{apiLastModified:l,selectedLocation:s,selectedFish:o,selectFish:c})})]})}const Z=n.lazy(()=>B(()=>import("./Map-Coox1mSQ.js"),__vite__mapDeps([0,1,2,3])));function le({apiLastModified:l}){var R,v;const[s,o]=n.useState(null),[c,r]=n.useState(null),[i,a]=n.useState(null),[e,m]=n.useState(null),[E,p]=n.useState(null),[x,g]=n.useState(!1),j=n.useRef(null),h=L();h.setLandingPage("home"),f(l);const C=f(l),S=f(l);n.useState(()=>{p(h.getUserSelectedRegion())},[]);const b=u=>{h.setUserSelectedRegion(u),p(u),g(!1)};n.useEffect(()=>{C.get("/api/locations").then(u=>o(u.data.locations))},[]),n.useEffect(()=>{const u=h.getUserSelectedFish();u&&a(u)},[]),n.useEffect(()=>{var u;if(e){r(null);let d="/api/fishByLocation/"+e.value.regionId;d+="/"+(((u=e.value)==null?void 0:u.waterId)??0),d+="/"+(i??0),S.get(d).then(_=>{r(_.data.limits)})}},[e,i]);const N=u=>{let d;i===u?d=null:d=u,h.setUserSelectedFish(d),a(d)},y=()=>{m(null),setTimeout(()=>{j.current.click()},10)},T=u=>{m(u)};return t.jsxs(z,{selectedLocation:e,selectedFish:i,selectFish:N,children:[x&&t.jsx(n.Suspense,{fallback:t.jsx("div",{className:"loading",children:t.jsx(k,{})}),children:t.jsx(Z,{apiLastModified:l,locations:s,selectRegion:b,setShowMap:g})}),!x&&s!==null&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"focused-layout",children:[t.jsx("div",{className:"header",children:e&&t.jsx(q,{selectedLocation:e,onClick:y})}),t.jsxs("div",{className:"body",children:[e?t.jsx(A,{isLoading:S.state.loading,restrictions:c,regionId:(R=e==null?void 0:e.value)==null?void 0:R.regionId,waterId:(v=e==null?void 0:e.value)==null?void 0:v.waterId}):null,t.jsx($,{className:e?"hidden":"",inputRef:j,locations:s,selectedRegion:E,selectRegion:b,onChange:T,setShowMap:g})]})]}),t.jsx("div",{className:"logo",children:t.jsx("img",{src:"/images/logo.png"})})]})]})}export{le as default};
