import{r as y,j as r}from"./app-kGfqBWgu.js";import{i as p,p as x,a as g,b as j,f as m,c as h}from"./parseMySqlDate-CERvkhiN.js";import{T as E,F as w}from"./Tooltip-DXmS03Wp.js";import{u as F}from"./useScreenOrientation-CeycFIh4.js";function D(t){var e;return{id:t.id,seasonStart:x(t.season_start),seasonEnd:x(t.season_end),bagLimit:t.bag_limit,minSize:t.minimum_size,maxSize:t.maximum_size,fishingMethod:L(t),tidal:z(t),water:((e=t==null?void 0:t.water)==null?void 0:e.name)??"",waterDescription:t.water_description??""}}function L(t){var s,a;let e="";return((s=t==null?void 0:t.fishing_method)==null?void 0:s.name)==="May only be angled by artificial fly or baited barbless hook with a single point"?e="Fly Fishing":e=((a=t==null?void 0:t.fishing_method)==null?void 0:a.name)??"",e}function z(t){let e="";return t.tidal_category&&(e&&(e+=" in "),e+=t.tidal_category.name+" waters"),e}function v(t){return t.reduce((e,s)=>{let a=0,c=!1;for(;!c&&a<e.length;)!e[a].waterDescription&&g(s.seasonStart,e[a].seasonStart)&&g(s.seasonEnd,e[a].seasonEnd)&&s.bagLimit===e[a].bagLimit&&s.minimumSize===e[a].minimumSize&&s.maximumSize===e[a].maximumSize&&(c=!0,s.fishingMethod!==e[a].fishingMethod&&(e[a].fishingMethod=""),s.tidal!==e[a].tidal&&(e[a].tidal="")),a++;return c||e.push(s),e},[])}function _(t){return t.sort((e,s)=>{const a=j(e.seasonStart,s.seasonStart);return a===0?s.fishingMethod||s.tidal||s.waterDescription?-1:j(s.seasonEnd,e.seasonEnd):a})}function R(t){if(!t.length)return;const e=t.reduce((s,a)=>{var o;const c=((o=a==null?void 0:a.fish)==null?void 0:o.name)??null;if(!s[c]){const l={seasonStart:null,seasonEnd:null,limits:[]};s[c]=l}return s[c].limits.push(D(a)),s},{});return Object.keys(e).forEach(s=>{e[s].limits=v(e[s].limits),e[s].limits=_(e[s].limits),e[s].limits.forEach(o=>{o.bagLimit&&(e[s].seasonStart?p(o.seasonStart,e[s].seasonStart)&&(e[s].seasonStart=o.seasonStart):e[s].seasonStart=o.seasonStart,e[s].seasonEnd&&p(o.seasonEnd,e[s].seasonEnd)||(e[s].seasonEnd=o.seasonEnd))});const a={};let c=0;for(;c<e[s].limits.length;){const o=e[s].limits[c],l=[o.fishingMethod,o.tidal,o.waterDescription].join("-");o.waterDescription&&a[l]?(a[l].group||(a[l].group=[]),a[l].group.push(o),e[s].limits.splice(c,1)):(a[l]=o,c++)}}),e}function T({limits:t}){const e=R(t),s=F(),a=y.useRef(null),c=(n,i=!1)=>r.jsxs(r.Fragment,{children:[r.jsxs("span",{children:[m(n.seasonStart,s.isMobile?h.displayDayMonthShortFormat:h.displayDayMonthFormat)," "]}),r.jsxs("span",{children:["-"," ",m(n.seasonEnd,s.isMobile?h.displayDayMonthShortFormat:h.displayDayMonthFormat),i?",":""]})]}),o=n=>n.waterDescription?r.jsx("em",{className:"water-description",children:l(n,!1)}):null,l=(n,i=!0)=>{if(i&&n.waterDescription)return"";let d=(n==null?void 0:n.water)??"";return n.fishingMethod&&(d+=d?": ":""+n.fishingMethod),n.tidal&&(d&&(d+=" in "),d+=n.tidal),d||(d+=n.water),d+=" "+n.waterDescription,d},S=n=>{const i=(n==null?void 0:n.minSize)??"N/A";return n.bagLimit===0?r.jsx("span",{className:"invalid",children:i}):i},M=n=>{const i=(n==null?void 0:n.maxSize)??"N/A";return n.bagLimit===0?r.jsx("span",{className:"invalid",children:i}):i},b=n=>n.bagLimit===null?r.jsx("span",{className:"text-md leading-4",children:"∞"}):n.bagLimit,u=(n,i=!1)=>r.jsxs("div",{className:`limit ${i?"group":""} ${n.group?"group-start":""}`,children:[r.jsxs("div",{className:"season-exception",children:[r.jsx("span",{className:"date-span",children:c(n,n.group||i)}),r.jsxs("em",{className:"exception",children:[" ",l(n)]})]}),r.jsx("div",{children:b(n)}),r.jsx("div",{children:S(n)}),r.jsx("div",{children:M(n)})]}),f=(n,i=!1)=>n.map((d,N)=>d!=null&&d.group?r.jsxs(r.Fragment,{children:[u(d),f(d.group,!0),o(d)]}):r.jsxs(r.Fragment,{children:[u(d,i),i?null:o(d)]}));return r.jsxs("div",{className:"FishLimitsGrid",ref:a,children:[r.jsxs("div",{className:"header",children:[r.jsxs("div",{className:"column-header date-range",children:[!s.isMobile&&r.jsx(r.Fragment,{children:"Fish/Season/"}),"Restrictions"]}),r.jsx("div",{className:"column-header",children:"Bag Limit"}),r.jsxs("div",{className:"column-header",children:[s.isMobile?"Min.":"Minimum"," ","Size"]}),r.jsxs("div",{className:"column-header",children:[s.isMobile?"Max.":"Maximum"," ","Size"]})]}),r.jsx("div",{className:"body",children:Object.keys(e??{}).map((n,i)=>r.jsxs("div",{className:"fish-row-container",children:[r.jsxs("div",{className:`fish-name ${i%2===0?"even":"odd"}`,children:[r.jsxs("div",{className:"fish-season",children:[r.jsx("strong",{children:n}),r.jsxs("em",{children:["(",c(e[n]),")"]})]}),r.jsx("div",{className:"flex",children:e[n].limits.length>1?r.jsx(E,{message:"Some Restrictions",containerRef:a,children:r.jsx(w,{className:"alert"})}):null})]}),r.jsx("div",{className:`limits ${i%2===0?"even":"odd"}`,children:f(e[n].limits)})]},n))})]})}export{T as default};
